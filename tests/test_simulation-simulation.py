from imt_lightcurve.models.lightcurve import LightCurve
from imt_lightcurve.simulation.simulation import Simulate


time = [-0.1481600000,-0.1422336000,-0.1363072000,-0.1303808000,-0.1244544000,-0.1185280000,-0.1126016000,-0.1066752000,-0.1007488000,-0.0948224000,-0.0888960000,-0.0829696000,-0.0770432000,-0.0711168000,-0.0651904000,-0.0592640000,-0.0533376000,-0.0474112000,-0.0414848000,-0.0355584000,-0.0296320000,-0.0237056000,-0.0177792000,-0.0118528000,-0.0059264000,0.0000000000,0.0059264000,0.0118528000,0.0177792000,0.0237056000,0.0296320000,0.0355584000,0.0414848000,0.0474112000,0.0533376000,0.0592640000,0.0651904000,0.0711168000,0.0770432000,0.0829696000,0.0888960000,0.0948224000,0.1007488000,0.1066752000,0.1126016000,0.1185280000,0.1244544000,0.1303808000,0.1363072000,0.1422336000,0.1481600000]
flux = [0.9998890000,0.9998620000,0.9998410000,0.9998240000,0.9998330000,0.9998400000,0.9998260000,0.9997920000,0.9997690000,0.9997670000,0.9997310000,0.9996390000,0.9994670000,0.9991300000,0.9985820000,0.9977730000,0.9966470000,0.9952250000,0.9935850000,0.9918480000,0.9901580000,0.9886300000,0.9873990000,0.9865560000,0.9860810000,0.9859430000,0.9861100000,0.9865810000,0.9873940000,0.9885630000,0.9900410000,0.9917440000,0.9935490000,0.9953280000,0.9969150000,0.9981570000,0.9990020000,0.9994800000,0.9996950000,0.9997550000,0.9997350000,0.9996680000,0.9995930000,0.9995660000,0.9996100000,0.9997080000,0.9998520000,1.0000200000,1.0001600000,1.0002200000,1.0002200000]
flux_error = [0.0004429030,0.0004730390,0.0005336970,0.0006176250,0.0006609910,0.0006181630,0.0005694660,0.0007174970,0.0010042000,0.0012532200,0.0014065300,0.0015066500,0.0015661100,0.0015462300,0.0014475700,0.0013270600,0.0012236200,0.0011347000,0.0010342600,0.0009445330,0.0008957230,0.0009176060,0.0010341200,0.0012847100,0.0016077100,0.0018928900,0.0020054000,0.0018970600,0.0016677200,0.0014806900,0.0013842700,0.0013265800,0.0012413100,0.0011207500,0.0009860860,0.0009293850,0.0010354500,0.0011807500,0.0012602800,0.0012458800,0.0011885000,0.0011429700,0.0011507400,0.0012024600,0.0012284900,0.0011691800,0.0010192300,0.0008780320,0.0007979110,0.0007564010,0.0007313150]
x_values = [1.5000000000,1.4000000000,1.3000000000,1.2000000000,1.1000000000,1.0000000000,0.9000000000,0.8000000000,0.7000000000,0.6000000000,0.5000000000,0.4000000000,0.3000000000,0.2000000000,0.1000000000,0.0000000000,0.1000000000,0.2000000000,0.3000000000,0.4000000000,0.5000000000,0.6000000000,0.7000000000,0.8000000000,0.9000000000,1.0000000000,1.1000000000,1.2000000000,1.3000000000,1.4000000000,1.5000000000]

observed_curve = LightCurve(time, flux, flux_error)

SimulateObject = Simulate()
## Simulate values
final_table_sorted_by_chi2 = SimulateObject.simulate_values(observed_curve, [0.91, 0.92], [0.13, 0.14], [13, 14], [18.3, 18.4], x_values, results_to_csv=False)

## Build the lightcurve with the best parameters computeds
simulated_curve = SimulateObject.simulate_lightcurve(observed_curve=observed_curve, x_values=x_values)
chi2 = simulated_curve.compare_results(see_values=False)

def test_simulate_values_with_chi2():
    assert chi2 == 9.92326701414888